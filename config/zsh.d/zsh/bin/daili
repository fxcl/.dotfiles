#!/usr/bin/env bash

# Define global variables
DEFAULT_PROXY="http://127.0.0.1:7890"
NO_PROXY_LIST="127.0.0.1,localhost,auiag.corp,iag.com.au,devlabs,192.168.2.0/24,localaddress,.localdomain.com,192.168.99.100,192.168.10.100,iagcloud.net,192.168.49.2,DB8B4788812536AC063DABFD95299A5C.gr7.ap-southeast-2.eks.amazonaws.com"

# Function to set proxy environment variables
set_proxy_vars() {
    export http_proxy=$1
    export https_proxy=$1
    export ftp_proxy=$1
    export rsync_proxy=$1
    export HTTP_PROXY=$1
    export HTTPS_PROXY=$1
    export FTP_PROXY=$1
    export RSYNC_PROXY=$1
    #git config --global http.proxy "$1"
    #git config --global https.proxy "$1"
    echo "Proxy environment variables set to $1"
}

# Enable proxy
proxy_on() {
    export no_proxy=$NO_PROXY_LIST
    export NO_PROXY=$no_proxy

    if [[ -n "$1" ]]; then
        if [[ $1 =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+:[0-9]+$ ]]; then
            set_proxy_vars "http://$1/"
        else
            echo "Invalid address format. Expected format: IP:PORT"
            return 1
        fi
    else
        set_proxy_vars "$DEFAULT_PROXY"
    fi
}

# Disable proxy
proxy_off() {
    unset http_proxy https_proxy ftp_proxy rsync_proxy no_proxy HTTP_PROXY HTTPS_PROXY FTP_PROXY RSYNC_PROXY NO_PROXY
    #git config --global --unset http.proxy
    #git config --global --unset https.proxy
    echo "Proxy environment variables removed."
}

# Handle script arguments and options
case "$1" in
    on)
        proxy_on "$2"
        ;;
    off)
        proxy_off
        ;;
    *)
        echo "Usage: $0 {on [IP:PORT] | off}"
        exit 1
        ;;
esac
